<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8" />
	<script src="http://code.jquery.com/jquery-2.0.3.js"></script>
	<script src="https://raw.github.com/linkedin/dustjs/master/dist/dust-full.js"></script>
</head>	
<body>
<script type='text/javascript'>

//-- View --//
var View = function() {
	//Model을 Observe한다는 것을 목표로 하지만, 아직은 구현 못함. how? 
	this.render = function(model, templateUrl, templateKey){
		$.get( templateUrl, function( template ) {
	  		console.log("load template html: ", template);

			// Compile 
			var compiled = dust.compile(template, templateKey);
			console.log("compiled: ", compiled);

			// Load
			dust.loadSource(compiled);

			// Rendering
			console.log("responseText: " , model.responseText);
			dust.render(templateKey, JSON.parse(model.responseText) , function(err, out){
				console.log("final(success): ", out);
				console.log("final(err): ", err);
				$("#table_content").html(out);
			});
		});
	};
};
//-- View --//

// -- Model -- //
var ProductModel = function() {
	this.get = function(){
		var modelUrl = "https://raw.github.com/chanwookpark/singlepageapp/master/ui/product-model.json";
		var modelJson = $.getJSON(modelUrl);
		console.log("Model: ", modelJson);
		return modelJson;
	};
};
// -- Model -- //

// -- Event Logic -- //
var ViewEventLogic = function() {
	this.init = function() {
		//json 받아.. 
		var model = productModel.get();
		
		productView.render(model, templateUrl, templateKey);
	}
}
// -- Event Logic -- //

var templateUrl = "https://raw.github.com/chanwookpark/singlepageapp/master/ui/product-template.html";
var templateKey = "_prd";

var productModel = new ProductModel();
var productView = new View();
var productEventLogic = new ViewEventLogic();

$(document).ready(function(){
	productEventLogic.init();
});

	
</script>

<b> Grid </b>
<div>
<form>
<table border="1">
	<thead>
		<tr>
			<th>선</th>
			<th>번호</th>
			<th>상품ID</th>
			<th>상품이름</th>
			<th>상품가격</th>
		</tr>
	</thead>
	<tbody id="table_content">
	</tbody>
</table>
<input type="submit" value="저장" />
</form>
</div>

</body>
</html>